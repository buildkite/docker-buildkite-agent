FROM ubuntu:14.04
MAINTAINER Tim Lucas <tim@buildkite.com>

# Install the essentials needed to add more apt repos, and any others
RUN apt-get update -qq && apt-get install -qqy \
    apt-transport-https \
    ca-certificates \
    curl \
    openssh-client \
    git

# Install Buildkite
RUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 32A37959C2FA5C3C99EFBC32A79206696452D198 && \
    echo 'deb https://apt.buildkite.com/buildkite-agent experimental main' > /etc/apt/sources.list.d/buildkite-agent.list && \
    apt-get update -qq && \
    apt-get install -qqy buildkite-agent && \
    mkdir -p /buildkite/hooks /buildkite/builds /buildkite/plugins

ENV BUILDKITE_BUILD_PATH=/buildkite/builds \
    BUILDKITE_HOOKS_PATH=/buildkite/hooks \
    BUILDKITE_PLUGINS_PATH=/buildkite/plugins

ENTRYPOINT ["buildkite-agent"]
CMD ["start"]
